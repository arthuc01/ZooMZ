# ZooMZ Browser App for doing ZooMS collagen analysis (React + Plotly)

![ZooMZ logo](ZooMZ_logo.png)

[Zooarchaeology by mass spectrometry](ZooMS.md), commonly referred to by the abbreviation ZooMS, is a scientific method that identifies animal species by means of characteristic peptide sequences in the protein collagen.

This app supports:

- Upload `.mzML` / `.mzXML` files (batch)
- Interactive Plotly spectrum (zoom/pan)
- Peak picking
- Matching against **Speciescan-style reference DB CSVs** (one row per species/taxon; marker m/z in columns)
- Automatic contaminant search from `public/reference_dbs/contaminants_list.csv`
- Per-sample confidence using target-decoy FDR scoring with configurable decoy settings
- Batch Excel export with QC summary, marker matches, and contaminants
- Confidence labels (High/Medium/Low) in results tables
- Note: expected input files are single-scan MALDI MS (multi-scan mzML is not supported)
- See Settings and QC explanations: [Settings_QC.md](Settings_QC.md)

## How to run analyses

- Single sample
  Upload one mzML/mzXML and run once to inspect the spectrum and results interactively.
- Small batch (uploaded files)
  Multi-select uploads and run; results append as multiple rows in the output Excel.
- Folder processing
  Select a local folder containing many mzML/mzXML files (for example, Zenodo datasets). The app processes every spectrum found and appends one row per file to the output Excel. Errors are logged per-file and do not stop the run.

Folder processing is intended for high-throughput validation runs (hundreds/thousands of spectra).

FDR confidence thresholds used in the app:
- FDR gate: qSample > 0.05 => Rejected (not acceptable)
- Decoy gap is the difference between the top real score and the best decoy score; larger gaps indicate stronger separation, while zero/negative gaps suggest weak confidence.

## Confidence estimation

Confidence levels reflect separation from random matches and from competing taxa, not a single statistical probability.

Procedure summary:
- FDR control (q-value): reject if qSample > 0.05
- Separation from decoys: use best_score / best_decoy_score (or best_score - best_decoy_score when decoy scores are very small)
- Taxonomic discrimination: down-weight when top and second-best taxa are very close
- Evidence sufficiency (optional): down-weight if very few markers support the call

Ratio thresholds (when best_decoy_score >= 0.01):
- High: ratio >= 2.5 and best_score >= 0.03
- Medium: ratio >= 1.8 and best_score >= 0.02
- Low: ratio >= 1.3
- Rejected: otherwise

Gap thresholds (when best_decoy_score < 0.01):
- High: decoy_gap >= 0.15
- Medium: 0.10 <= decoy_gap < 0.15
- Low: 0.05 <= decoy_gap < 0.10
- Rejected: decoy_gap < 0.05

Override:
- If qSample <= 0.01 and decoy_gap >= 0.15, confidence is forced to High.
Strong separation from decoys (low q and large decoy gap) is decisive; close scores among top taxa may be flagged as ambiguity but will not demote a strongly supported identification.

Confidence	Interpretation
High	Strongly above decoys and clearly separated from alternative taxa
Medium	Above decoys but limited separation or moderate ambiguity
Low	Statistically admissible but weak separation or sparse evidence
Rejected	Not convincingly above random matches

Confidence labels are intended as interpretive guidance, not exact probabilities.


## Run

This app is hosted on Github Pages [https://arthuc01.github.io/ZooMZ/](https://arthuc01.github.io/ZooMZ/)

```bash
npm install
npm run dev
```

## Deploy (GitHub Pages)

This repo is configured to deploy on pushes to `main` via GitHub Actions.
If your repository name is not `ZooMZ`, update the `base` path in
`vite.config.ts` to `/<your-repo>/`.

## Reference DBs

Folder: `public/reference_dbs/`

- `manifest.json` lists selectable databases + contaminants file
- Populate the folder with Speciescan CSVs and update the manifest if you add/remove files.

[SpecieScan](https://github.com/mesve/SpecieScan)

Emese I Végh, Katerina Douka, SpecieScan: semi-automated taxonomic identification of bone collagen peptides from MALDI-ToF-MS, Bioinformatics, Volume 40, Issue 3, March 2024, btae054, 
[https://doi.org/10.1093/bioinformatics/btae054](https://doi.org/10.1093/bioinformatics/btae054)

Xenarthrans reference DB: https://pubs.acs.org/doi/10.1021/acs.jproteome.5c00636
Note: only MALDI-observable markers are included in the Xenarthrans list.


***In-silico marker database (experimental)***

In addition to empirically validated ZooMS marker databases, ZooMZ optionally supports an experimental in-silico–derived collagen marker database.

This database is generated by downloading COL1A1 and COL1A2 protein sequences from UniProt, performing an in-silico tryptic digest, calculating monoisotopic peptide masses, and filtering peptides to the typical ZooMS mass range. Candidate markers are then selected based on their taxonomic presence patterns (informativeness) across species or higher taxonomic groupings.

The in-silico database is intended for exploratory analysis, method development, and assessing potential taxonomic resolution, and should not be interpreted as a replacement for empirically validated ZooMS markers. Marker presence reflects sequence-derived predictions rather than confirmed MALDI detectability, and results should therefore be interpreted with appropriate caution.

Users can select the in-silico database explicitly via the database selector in the application interface. By default, ZooMZ continues to prioritise experimentally established ZooMS reference databases.

***RuBisCO (rbcL) Reference Database***

This repository includes a reference database derived from the RuBisCO large subunit (rbcL) to illustrate how the peptide-fingerprint matching and false discovery rate (FDR) framework implemented here can be applied beyond collagen-based ZooMS analyses.

RuBisCO provides a widely recognised example of a globular, non-structural protein with substantial sequence diversity across plants and algae. Its inclusion highlights the potential for extending fingerprint-based identification with statistical confidence estimation to protein families with very different sequence characteristics from collagen.

****Database construction****

The RuBisCO reference database is generated entirely in silico using curated UniProtKB protein sequences:

****Sequence selection****
RuBisCO large-subunit (rbcL) sequences are retrieved from UniProtKB using taxonomy- and gene-based queries, providing a compact but diverse reference set suitable for methodological evaluation.

****In silico digestion****
Protein sequences are digested using a trypsin cleavage model (cleavage after K/R except before P), with limited missed cleavages permitted. Peptides are filtered to a MALDI-TOF-relevant m/z range.

****Peptide mass calculation****
Monoisotopic peptide masses are calculated for singly protonated ions, consistent with peptide mass fingerprinting workflows.

****Decoy generation and FDR estimation****
Decoy peptides are generated by shuffling full protein sequences prior to digestion, producing a realistic background mass distribution while preserving amino-acid composition. Target and decoy peptides are treated identically, enabling estimation of false discovery rates from score distributions.

****Purpose and outlook****

The RuBisCO database demonstrates how the underlying framework can be applied to non-collagenous proteins, supporting the broader applicability of statistically grounded fingerprint matching in contexts where tandem MS data may be unavailable or impractical.

Together with collagen-based ZooMS analyses, this example highlights a general approach for peptide mass fingerprint identification with quantitative confidence estimates, and points toward future applications across a wider range of proteins, enzymes, and sample types.
